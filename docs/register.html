<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register | TOPCIT Quest</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script defer src="script.js"></script>
</head>
<body class="auth-bg">
  <!-- Auth page: header removed -->

  <main class="container auth-page" aria-label="Main">
    <section class="auth-shell">
      <aside class="auth-illustration">
        <!-- background handled via .auth-page.auth-bg -->
      </aside>
      <div class="auth-panel card">
        <div class="auth-brand register-brand">
          <img src="topcit-quest-logo.svg" alt="TOPCIT Quest logo" class="auth-logo" />
        </div>
        <h2 style="margin:0 0 8px">Register</h2>
        <p class="topic-desc" style="margin-bottom:16px">Fill in your details below.</p>

        <form id="register-form" novalidate>
          <div class="grid-12" style="gap:12px">
            <label class="span-6">
              <div class="topic-title" style="font-size:13px">Name</div>
              <input type="text" id="reg-name" class="text-input" placeholder="Your name" required />
            </label>
            <label class="span-6">
              <div class="topic-title" style="font-size:13px">Username</div>
              <input type="text" id="reg-username" class="text-input" placeholder="Choose a username" required />
            </label>
            <label class="span-6">
              <div class="topic-title" style="font-size:13px">Email</div>
              <input type="email" id="reg-email" class="text-input" placeholder="you@example.com" required />
            </label>
            <label class="span-6">
              <div class="topic-title" style="font-size:13px">Phone Number</div>
              <input type="tel" id="reg-phone" class="text-input" placeholder="+63 912 345 6789" />
            </label>
            <label class="span-6">
              <div class="topic-title" style="font-size:13px">Password</div>
              <div class="password-field">
                <input type="password" id="reg-password" class="text-input" placeholder="••••••••" required />
                <button type="button" class="password-toggle" onclick="togglePassword('reg-password', this)">
                  <span class="ms">visibility</span>
                </button>
              </div>
            </label>
            <label class="span-6">
              <div class="topic-title" style="font-size:13px">Confirm Password</div>
              <div class="password-field">
                <input type="password" id="reg-confirm" class="text-input" placeholder="••••••••" required />
                <button type="button" class="password-toggle" onclick="togglePassword('reg-confirm', this)">
                  <span class="ms">visibility</span>
                </button>
              </div>
            </label>
          </div>
          <div class="auth-actions">
            <button class="btn primary" type="submit">Create account</button>
            <button class="btn google-btn" type="button" id="google-register">
              <span class="google-icon-badge">
                <img src="images/google.webp" alt="Google" class="google-icon">
              </span>
              <span class="google-text">Sign up with Google</span>
            </button>
          </div>
          <div style="margin-top:12px;color:var(--muted);font-weight:700">
            Already have an account? <a href="login.html" class="link-text">Login</a>
          </div>
          <div id="register-error" class="topic-desc" style="color:#dc2626;display:none;margin-top:8px">Please fix the highlighted fields.</div>
        </form>
      </div>
    </section>
  </main>

  <footer class="app-footer">© 2025 Topcit Quest</footer>

  <script>
    // Google OAuth Configuration
    const GOOGLE_CLIENT_ID = '598357286838-uvrs8bi3apbvnu4bkm6d6ojtdhfq819j.apps.googleusercontent.com'; // Google Client ID for OAuth authentication
    
    function saveUser(user){
      try{ localStorage.setItem('topcit_user', JSON.stringify(user)); }catch(_){ }
    }
    function isValidEmail(v){ return /.+@.+\..+/.test(v) }
    function isValidUsername(u){ return /^[a-zA-Z0-9_.-]{3,}$/.test(u) }
    function isValidPhonePH(v){
      if(!v) return true; // optional
      return /(\+63\s?9\d{2}\s?\d{3}\s?\d{4}|09\d{2}\s?\d{3}\s?\d{4})$/.test(v.trim());
    }
    function setFieldError(el, has){ if(el) el.classList.toggle('error', !!has); }
    
    // Initialize Google OAuth when the page loads
    window.onload = function() {
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleGoogleResponse
      });
    };
    
    // Handle Google OAuth response
    function handleGoogleResponse(response) {
      try {
        const payload = JSON.parse(atob(response.credential.split('.')[1]));
        const user = {
          name: payload.name,
          email: payload.email,
          picture: payload.picture,
          provider: 'google'
        };
        saveUser(user);
        localStorage.setItem('topcit_notice', 'logged_in');
        showGoogleLoginSuccessModal(user.name);
        setTimeout(() => {
          window.location.href = 'index.html';
        }, 2000);
      } catch (error) {
        console.error('Google authentication error:', error);
        document.getElementById('register-error').textContent = 'Google authentication failed. Please try again.';
        document.getElementById('register-error').style.display = 'block';
      }
    }
    
    // Trigger Google OAuth when button is clicked
    function initiateGoogleLogin() {
      google.accounts.id.prompt();
    }
    
    document.getElementById('register-form').addEventListener('submit', function(e){
      e.preventDefault();
      const nameEl = document.getElementById('reg-name');
      const userEl = document.getElementById('reg-username');
      const emailEl = document.getElementById('reg-email');
      const phoneEl = document.getElementById('reg-phone');
      const passEl = document.getElementById('reg-password');
      const confEl = document.getElementById('reg-confirm');
      const err = document.getElementById('register-error');

      const name = nameEl.value.trim();
      const username = userEl.value.trim();
      const email = emailEl.value.trim();
      const phone = phoneEl.value.trim();
      const pass = passEl.value;
      const conf = confEl.value;

      const errors = [];
      [nameEl,userEl,emailEl,phoneEl,passEl,confEl].forEach(el=>setFieldError(el,false));
      err.style.display = 'none';
      err.innerHTML = '';

      if(!name){ errors.push('Full name is required.'); setFieldError(nameEl,true); }
      if(!username){ errors.push('Username is required.'); setFieldError(userEl,true); }
      else if(!isValidUsername(username)){ errors.push('Username must be 3+ characters (letters, numbers, ., _, -).'); setFieldError(userEl,true); }
      if(!email){ errors.push('Email is required.'); setFieldError(emailEl,true); }
      else if(!isValidEmail(email)){ errors.push('Enter a valid email address.'); setFieldError(emailEl,true); }
      if(phone && !isValidPhonePH(phone)){ errors.push('Phone should be PH format: +63 9XX XXX XXXX or 09XX XXX XXXX.'); setFieldError(phoneEl,true); }
      if(!pass){ errors.push('Password is required.'); setFieldError(passEl,true); }
      else if(pass.length < 6){ errors.push('Password must be at least 6 characters.'); setFieldError(passEl,true); }
      if(!conf){ errors.push('Please confirm your password.'); setFieldError(confEl,true); }
      else if(pass !== conf){ errors.push('Passwords do not match.'); setFieldError(confEl,true); }

      if(errors.length){ err.innerHTML = errors.join('<br>'); err.style.display = 'block'; return; }

      saveUser({ name, username, email, phone, provider: 'local' });
      try{ localStorage.setItem('topcit_notice','logged_in'); }catch(_){ }
      window.location.href = 'index.html';
    });
    
    document.getElementById('google-register').addEventListener('click', initiateGoogleLogin);
    
    // Password toggle functionality
    function togglePassword(inputId, button) {
      const input = document.getElementById(inputId);
      const icon = button.querySelector('.ms');
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.textContent = 'visibility_off';
      } else {
        input.type = 'password';
        icon.textContent = 'visibility';
      }
    }
    
    // Google login success modal
    function showGoogleLoginSuccessModal(userName) {
      const modal = document.createElement('div');
      modal.className = 'modal-backdrop google-success-modal';
      modal.innerHTML = `
        <div class="modal card" style="max-width: 400px; text-align: center;">
          <div style="margin-bottom: 16px;">
            <span class="ms" style="font-size: 48px; color: #10b981;">check_circle</span>
          </div>
          <h3 style="margin: 0 0 8px; color: var(--text);">Welcome, ${userName}!</h3>
          <p style="margin: 0; color: var(--muted);">Successfully registered with Google. Redirecting...</p>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Show modal with animation
      setTimeout(() => modal.classList.add('open'), 10);
      
      // Remove modal after redirect
      setTimeout(() => {
        modal.classList.remove('open');
        setTimeout(() => document.body.removeChild(modal), 300);
      }, 1800);
    }
  </script>
</body>
</html>